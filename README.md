# 小戏骨应援相关项目

#### 12.21 更新
新增配置文件 settings.json, 相关配置可在配置文件中预先设定与修改，灵活应对网络问题

## settings 文件使用说明

**`settings.json`文件为本爬虫程序的配置文件，运行程序时必须保证两者处于同一文件夹！**
### **注意：** 首次运行程序未正确设置 settings 文件导致出错，请先删除 etc 文件夹，正确设置 settings 文件后再次运行！

## json 文件格式说明
1. 除内容外所有的符号均为英文输入符；
1. 除了存粹的数字，其余所有内容必须用双引号包裹；
2. 具有一一对应关系的字段对用大括号包裹，并用分号分割二者，字段对间用逗号分隔；
3. 具有同类并列关系的字段用中括号包裹，并用逗号分隔；
4. 其余知识点自行百度

## 字段含义说明
1. url_pre
固定参数，无需更改；
1. groups
所有需要爬取的群的集合；
**注意：**
    - 列举的群必须为自己账号已经加入的群，否则请删除对应条目；
    - 各条目分号前为自定义的群名，将来生产对应的文件夹；
    - 各条目分号后为群 qid，获取方法见文档；
    - 条目间用逗号分隔，最后一个条目后无逗号！
1. root_dir
抓取到数据后的储存位置，空值默认为当前程序所在文件夹，建议不做修改；
1. target_names
抓取数据的目标用户昵称；
**注意：**
    - 空值默认为抓取全体用户，建议不做修改；
    - 用户昵称必须是全称，用双引号包裹，逗号分隔，最后一个昵称后面不加逗号。
1. reconnect_times
信号不稳定时最大重连次数，正整数，建议不超过 5；
1. thr_pool_nums 
线程池大小，正整数，最大值为20，数值越大爬取越快，爬虫被拦截出错的概率越高，请用户根据出错率自行调整；
1. sleep_times 
随机休息倍数，非负整数，数值越大，爬取速度越慢，出错率越低，请用户根据出错率自行调整；
1. cookie
登陆验证信息，获取方式见文档。



### 项目列表：
1. 微博群爬虫 `wb.py`


### 项目简介
#### 微博群爬虫
爬取微博群中所有消息，并储存至本地。
##### 可配置参数：
1. 需要抓取的用户（比如“群主”、“小戏骨”）
    `target_names = []`
    空值获取抓取群内全部成员
1. 需要抓取的群 id 及对应群文件储存地址
    `gid = ''`
    配置 `gid` 的同时，需要配置 `gid_dict` 
    可从**开发者工具获取**

1. 需要获取的数据类型
    `target_type = {...}`
    **（默认获取全部种类数据，不需要的数据直接从代码中注释即可。）**
    - `AUDIO` 音频数据
    - `IMG` 图片数据
    - `TEXT` 文本数据
1. 数据存储根目录
    `root_dir = ''` 
    空值默认根目录为项目文件所在目录
1. 起始消息 id        
    `mid = ''`
    起始消息 id，必须提供，可从**开发者工具获取**
1. 登录状态信息
    `Cookie = ''`
    必须提供，可从**开发者工具获取**

##### 项目运行流程简介
1. 生成环境配置
    1. `Python3` 安装——[点击下载][1]
    1. `git` 安装——[点击下载][2]
    1. 克隆仓库代码 `git clone https://github.com/simadad/xxg.git`
    1. 安装依赖包 `pip install -r requirements.txt`
1. 项目初始化配置
    1. 登录网页版微博，获取并配置 Cookie
    1. 获取并配置群 id 及 `{qid: 群目录}` ——`gid`、`gid_dict`
    1. 获取并配置起始消息 id——`mid`
    1. 其余特殊需求配置 `target_names`、`target_type `、`root_dir`
1. 运行项目 `python wb.py`

[1]: https://www.python.org/downloads/release/python-352/    
[2]: https://git-scm.com/downloads
